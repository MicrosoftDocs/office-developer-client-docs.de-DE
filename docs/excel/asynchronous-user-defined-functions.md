---
title: Asynchrone benutzerdefinierte Funktionen
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: overview
localization_priority: Normal
ms.assetid: 142eb27e-fb6f-4da3-bfb7-a88115bbb5d5
description: 'Gilt für: Excel 2013 | Office 2013 | Visual Studio'
ms.openlocfilehash: 7fdf3bd09914981865c911fd65a78d044ad582f4
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/28/2019
ms.locfileid: "33412310"
---
# <a name="asynchronous-user-defined-functions"></a><span data-ttu-id="5e7a4-103">Asynchrone benutzerdefinierte Funktionen</span><span class="sxs-lookup"><span data-stu-id="5e7a4-103">Asynchronous user-defined functions</span></span>

<span data-ttu-id="5e7a4-104">**Gilt für**: Excel 2013 | Office 2013 | Visual Studio</span><span class="sxs-lookup"><span data-stu-id="5e7a4-104">**Applies to**: Excel 2013 | Office 2013 | Visual Studio</span></span> 
  
<span data-ttu-id="5e7a4-105">Microsoft Excel 2013 können benutzerdefinierte Funktionen asynchron aufrufen.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-105">Microsoft Excel 2013 can call user-defined functions asynchronously.</span></span> <span data-ttu-id="5e7a4-106">Das asynchrone Aufrufen von Funktionen kann die Leistung verbessern, indem mehrere Berechnungen gleichzeitig ausgeführt werden können.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-106">Calling functions asynchronously can improve performance by allowing several calculations to run at the same time.</span></span> <span data-ttu-id="5e7a4-107">Wenn Sie benutzerdefinierte Funktionen in einem Computecluster ausführen, können dank asynchroner Funktionsaufrufe mehrere Computer für die Durchführung von Berechnungen verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-107">When you run user-defined functions on a compute cluster, calling functions asynchronously enables several computers to be used to complete the calculations.</span></span>
  
## <a name="when-to-use-asynchronous-user-defined-functions"></a><span data-ttu-id="5e7a4-108">Verwendung asynchroner benutzerdefinierter Funktionen</span><span class="sxs-lookup"><span data-stu-id="5e7a4-108">When to use asynchronous user-defined functions</span></span>

<span data-ttu-id="5e7a4-109">Einige benutzerdefinierte Funktionen müssen auf externe Ressourcen warten.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-109">Some user-defined functions must wait for external resources.</span></span> <span data-ttu-id="5e7a4-110">Während sie warten, wird Excel-Berechnungsthread blockiert.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-110">While they wait, the Excel calculation thread is blocked.</span></span> <span data-ttu-id="5e7a4-111">In Excel 2013 können benutzerdefinierte Funktionen asynchron ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-111">In Excel 2013, user-defined functions can run asynchronously.</span></span> <span data-ttu-id="5e7a4-112">Dadurch kann der Berechnungsthread andere Berechnungen ausführen, während die benutzerdefinierte Funktion wartet.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-112">This frees the calculation thread to run other calculations while the user-defined function waits.</span></span>
  
<span data-ttu-id="5e7a4-113">In Excel 2007 konnten Programmierer mehrere benutzerdefinierte Funktionen gleichzeitig ausführen, indem sie die Anzahl der Threads erhöhen, die in Neuberechnungen mit mehreren Threads verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-113">In Excel 2007, programmers could run multiple user-defined functions at the same time by increasing the number of threads used in multiple-thread recalculations.</span></span> <span data-ttu-id="5e7a4-114">Diese Methode hat in erster Linie Nachteile, da die Anzahl der Threads eine Einstellung ist, die auf eine Anwendung begrenzt ist und nicht auf der Ebene einer einzelnen Funktion oder eines Add-Ins gesteuert werden kann.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-114">This method has drawbacks primarily because the number of threads is a setting scoped to an application and cannot be controlled at the level of a single function or an add-in.</span></span>
  
<span data-ttu-id="5e7a4-115">Programmierer sollten asynchrone benutzerdefinierte Funktionsaufrufe verwenden, wenn die Funktion auf externe Ressourcen warten muss.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-115">Programmers should use asynchronous user-defined function calls when the function must wait for external resources.</span></span> <span data-ttu-id="5e7a4-116">Beispielsweise muss eine Funktion, die eine SOAP-Anforderung über das Internet sendet, warten, bis das Netzwerk die Anforderung übermittelt, der Remoteserver die Anforderung abgeschlossen hat und das Netzwerk das Ergebnis zurücksendet.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-116">For example, a function that sends a SOAP request over the Internet must wait for the network to deliver the request, the remote server to complete the request, and the network to return the result.</span></span> <span data-ttu-id="5e7a4-117">In diesem Fall tritt keine signifikante Berechnung auf, und Excel können mit anderen Berechnungen fortgesetzt werden.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-117">In this case, there is no significant computing occurring and Excel can continue with other calculations.</span></span>
  
<span data-ttu-id="5e7a4-118">Programmierer können auch asynchrone benutzerdefinierte Funktionen verwenden, wenn eine Funktion Anforderungen an einen Computecluster sendet.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-118">Programmers can also use asynchronous user-defined functions when a function is sending requests to a compute cluster.</span></span> <span data-ttu-id="5e7a4-119">In diesem Fall muss nicht nur die Netzwerklatenz gewartet werden, sondern der Cluster kann separate Aufrufe auf separaten Servern ausführen.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-119">In this case, there is not only network latency to wait for, but the cluster can execute separate calls on separate servers.</span></span> <span data-ttu-id="5e7a4-120">Wenn sie nicht auf den Abschluss jedes Anrufs warten, können die Anrufe überlappen, um die Leistung zu verbessern.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-120">By not waiting for each call to finish, the calls can be overlapped to improve performance.</span></span> <span data-ttu-id="5e7a4-121">In einigen Fällen ist diese Verbesserung erheblich.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-121">In some cases this improvement is significant.</span></span>
  
> [!NOTE]
> <span data-ttu-id="5e7a4-122">Benutzerdefinierte Funktionen können nicht als asynchron und clustersicher registriert werden.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-122">User-defined functions cannot be registered as both asynchronous and cluster safe.</span></span> 
  
## <a name="writing-an-asynchronous-user-defined-function"></a><span data-ttu-id="5e7a4-123">Schreiben einer asynchronen benutzerdefinierten Funktion</span><span class="sxs-lookup"><span data-stu-id="5e7a4-123">Writing an asynchronous user-defined function</span></span>

<span data-ttu-id="5e7a4-124">Asynchrone benutzerdefinierte Funktionen müssen ein Handle nachverfolgen und dieses handle verwenden, wenn Excel, dass der Funktionsaufruf abgeschlossen ist.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-124">Asynchronous user-defined functions must keep track of a handle and use that handle when informing Excel that the function call is finished.</span></span> <span data-ttu-id="5e7a4-125">Eine asynchrone benutzerdefinierte Funktion wird in zwei Teile aufgeteilt.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-125">An asynchronous user-defined function is split into two pieces.</span></span> <span data-ttu-id="5e7a4-126">Der erste Teil ist der standardmäßige UDF-Einstiegspunkt, der einen zweiten, separaten asynchronen Vorgang startet.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-126">The first piece is the standard UDF entry point, which will launch a second, separate asynchronous operation.</span></span> <span data-ttu-id="5e7a4-127">Rückrufe in Excel sollten während des UDF-Einstiegspunkts vorgenommen werden.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-127">Callbacks into Excel should be made during the UDF entry point.</span></span> <span data-ttu-id="5e7a4-128">Der erste Startteil der Funktion gibt dann die Steuerung des Berechnungsthreads an Excel zurück, wodurch die Berechnung fortgesetzt wird.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-128">The first launching portion of the function will then return control of its calculation thread to Excel, which will continue calculation.</span></span> <span data-ttu-id="5e7a4-129">Wenn der zweite asynchrone Vorgang abgeschlossen ist, muss er den Excel aufrufen und Excel Ergebnis bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-129">When the second asynchronous operation is complete, it must call back into Excel and provide Excel with its result.</span></span> 
  
> [!NOTE]
> <span data-ttu-id="5e7a4-130">Alle an die UDF übergebenen Argumente, die vom asynchronen Teil der Funktion benötigt werden, müssen tief kopiert werden, da Excel diese Argumente freigibt, wenn der UDF-Einstiegspunkt zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-130">Any arguments passed into the UDF that are needed by the asynchronous portion the function must be deep copied because Excel frees these arguments when the UDF entry point returns.</span></span> 
  
<span data-ttu-id="5e7a4-131">Excel bietet eine Reihe von Ereignissen, die ein XLL-Add-In verwenden kann, um den Lebenszyklus asynchroner UDF-Aufrufe zu verwalten.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-131">Excel provides a set of events that an XLL add-in can use in order to manage the life cycle of asynchronous UDF calls.</span></span> <span data-ttu-id="5e7a4-132">Diese Ereignisse deuten darauf hin, Excel berechnungen abgeschlossen ist oder dass die Berechnung abgebrochen wurde.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-132">These events indicate that Excel is finished with calculations or that the calculation was canceled.</span></span>
  
### <a name="declaring-an-asynchronous-function"></a><span data-ttu-id="5e7a4-133">Deklarieren einer asynchronen Funktion</span><span class="sxs-lookup"><span data-stu-id="5e7a4-133">Declaring an asynchronous function</span></span>

<span data-ttu-id="5e7a4-134">Sie müssen asynchrone benutzerdefinierte Funktionen bei der Registrierung als asynchron deklarieren.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-134">You must declare asynchronous user-defined functions as asynchronous when they are registered.</span></span> <span data-ttu-id="5e7a4-135">Dazu wird ein Parameter hinzugefügt, der auf eine XLOPER12-Struktur verweist, dargestellt durch "X" in der Registrierungstypzeichenfolge, an einer beliebigen Stelle in der Liste der UDF-Parameter.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-135">This is performed by adding a parameter that points to a XLOPER12 structure, represented by "X" in the registration type string, anywhere in the list of UDF parameters.</span></span> <span data-ttu-id="5e7a4-136">Excel verwendet diesen Parameter, um das asynchrone Anrufhandle zu übergeben.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-136">Excel uses this parameter to pass the asynchronous call handle.</span></span> <span data-ttu-id="5e7a4-137">Das XLL-Add-In muss das asynchrone Anrufhandle und das Ergebnis der Funktion an Excel übergeben, wenn das Ergebnis bereit ist.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-137">The XLL add-in must pass the asynchronous call handle and the result of the function back to Excel when the result is ready.</span></span> <span data-ttu-id="5e7a4-138">Darüber hinaus sollte der Rückgabetyp der UDF **void** sein, der von ">" als erstes Zeichen in der Typzeichenfolge festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-138">In addition, the return type of the UDF should be **void**, designated by ">" as the first character in the type string.</span></span> <span data-ttu-id="5e7a4-139">Der Rückgabetyp ist void, da der synchrone Teil der UDF keinen Wert an Excel.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-139">The return type is void because the synchronous part of the UDF does not return a value to Excel.</span></span> <span data-ttu-id="5e7a4-140">Stattdessen gibt das XLL-Add-In einen Wert asynchron über einen Rückruf zurück.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-140">Instead, the XLL add-in returns a value asynchronously through a callback.</span></span> 
  
<span data-ttu-id="5e7a4-141">Sie können asynchrone Funktionen als threadsicher deklarieren, und dann wird der synchrone Teil der UDF in einer Neuberechnung mit mehreren Threads verwendet.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-141">You can declare asynchronous functions as thread-safe and then the synchronous part of the UDF is used in a multi-threaded recalculation.</span></span> 
  
<span data-ttu-id="5e7a4-142">Das folgende Codebeispiel zeigt eine asynchrone benutzerdefinierte Funktion, die mit \> "QX" als Registrierungstypzeichenfolge registriert wurde:</span><span class="sxs-lookup"><span data-stu-id="5e7a4-142">The following code example shows an asynchronous user-defined function registered by using "\>QX" as the registration type string:</span></span>
  
```cpp
void MyAsyncUDF(LPXLOPER12 arg1, LPXLOPER12 pxAsyncHandle)
{
…
}
```

### <a name="returning-values"></a><span data-ttu-id="5e7a4-143">Zurückgeben von Werten</span><span class="sxs-lookup"><span data-stu-id="5e7a4-143">Returning values</span></span>

<span data-ttu-id="5e7a4-144">Wenn das Ergebnis des asynchronen Aufrufs bereit ist, gibt das XLL-Add-In das Ergebnis an Excel durch Ausführen eines Rückrufs vom Typ [xlAsyncReturn zurück.](xlasyncreturn.md)</span><span class="sxs-lookup"><span data-stu-id="5e7a4-144">When the result of the asynchronous call is ready, the XLL add-in returns the result to Excel by performing a callback of type [xlAsyncReturn](xlasyncreturn.md).</span></span>
  
<span data-ttu-id="5e7a4-145">**xlAsyncReturn** ist der einzige Rückruf, den Sie während der Neuberechnung für Threads verwenden können, die keine Berechnungen enthalten.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-145">**xlAsyncReturn** is the only callback you can use on non-calculation threads during recalculation.</span></span> <span data-ttu-id="5e7a4-146">Daher sollte der asynchrone Teil einer asynchronen UDF keine weiteren Rückrufe ausführen.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-146">Therefore, the asynchronous part of an asynchronous UDF should not perform any other callbacks.</span></span> 
  
### <a name="handling-events"></a><span data-ttu-id="5e7a4-147">Behandeln von Ereignissen</span><span class="sxs-lookup"><span data-stu-id="5e7a4-147">Handling events</span></span>

<span data-ttu-id="5e7a4-148">Ab Excel 2010 können XLLs Ereignisse empfangen, die zum Verwalten des asynchronen Funktionslebenszyklus entwickelt wurden.</span><span class="sxs-lookup"><span data-stu-id="5e7a4-148">Starting in Excel 2010, XLLs can receive events designed to manage the asynchronous function life cycle.</span></span> <span data-ttu-id="5e7a4-149">Weitere Informationen finden Sie unter [Behandeln von Ereignissen](handling-events.md).</span><span class="sxs-lookup"><span data-stu-id="5e7a4-149">For more information, see [Handling Events](handling-events.md).</span></span>
  
## <a name="see-also"></a><span data-ttu-id="5e7a4-150">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="5e7a4-150">See also</span></span>

- [<span data-ttu-id="5e7a4-151">Entwickeln von XLLs für Excel</span><span class="sxs-lookup"><span data-stu-id="5e7a4-151">Developing Excel XLLs</span></span>](developing-excel-xlls.md)

